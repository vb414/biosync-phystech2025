<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioSync - Personal Health Optimizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script>
        // Global variables
        let currentStep = 'welcome';
        let userProfile = {
            name: '',
            age: '',
            gender: '',
            weight: '',
            height: '',
            activityLevel: '',
            bmi: null,
            bmr: null,
            maxHeartRate: null
        };
        
        let isExercising = false;
        let exerciseDuration = 0;
        let exerciseInterval = null;
        let biometrics = {
            heartRate: 72,
            heartRateZone: 'rest',
            hydrationLevel: 100,
            glycogenStores: 100,
            coreTemp: 37.0
        };
        let recommendations = [];
        let historicalData = [];
        // Helper functions
        function calculateBMI() {
            if (userProfile.weight && userProfile.height) {
                const height = parseFloat(userProfile.height) / 100;
                const weight = parseFloat(userProfile.weight);
                const age = parseInt(userProfile.age);
                const bmi = weight / (height * height);
                
                let bmr;
                if (userProfile.gender === 'male') {
                    bmr = 10 * weight + 6.25 * parseFloat(userProfile.height) - 5 * age + 5;
                } else {
                    bmr = 10 * weight + 6.25 * parseFloat(userProfile.height) - 5 * age - 161;
                }
                
                userProfile.bmi = bmi.toFixed(1);
                userProfile.bmr = Math.round(bmr);
                userProfile.maxHeartRate = 220 - age;
            }
        }
        
        function updateBiometrics() {
            const intensity = { running: 2.0, cycling: 1.5, swimming: 1.8, strength: 1.2, yoga: 0.8 };
            const exerciseType = document.getElementById('exerciseType') ? document.getElementById('exerciseType').value : 'running';
            const multiplier = intensity[exerciseType] || 1.5;
            
            const baseHR = 72;
            const maxHR = userProfile.maxHeartRate || 190;
            const targetHR = Math.min(baseHR + (exerciseDuration * multiplier * 0.3), maxHR * 0.85);
            biometrics.heartRate = Math.round(biometrics.heartRate + (targetHR - biometrics.heartRate) * 0.1);
            
            // Update heart rate zone
            const hrPercent = (biometrics.heartRate - baseHR) / (maxHR - baseHR) * 100;
            if (hrPercent > 80) biometrics.heartRateZone = 'peak';
            else if (hrPercent > 70) biometrics.heartRateZone = 'cardio';
            else if (hrPercent > 60) biometrics.heartRateZone = 'aerobic';
            else if (hrPercent > 50) biometrics.heartRateZone = 'fat-burn';
            else if (hrPercent > 0) biometrics.heartRateZone = 'warm-up';
            else biometrics.heartRateZone = 'rest';
            
            // Update other metrics
            biometrics.hydrationLevel = Math.max(biometrics.hydrationLevel - 0.3, 0);
            biometrics.glycogenStores = Math.max(biometrics.glycogenStores - 0.2, 0);
            biometrics.coreTemp = Math.min(biometrics.coreTemp + 0.01, 39.0);
            
            // Update historical data
            historicalData.push({
                time: exerciseDuration,
                heartRate: biometrics.heartRate,
                hydration: biometrics.hydrationLevel
            });
            if (historicalData.length > 30) historicalData.shift();
            
            updateRecommendations();
        }
        
        function updateRecommendations() {
            recommendations = [];
            const exerciseType = document.getElementById('exerciseType') ? document.getElementById('exerciseType').value : 'running';
            
            // 1. PERSONALIZED STATUS with user-specific insights
            recommendations.push({
                title: `${userProfile.name}'s AI Analysis`,
                message: `Monitoring your ${exerciseType} session - ${Math.floor(exerciseDuration/60)}:${(exerciseDuration%60).toString().padStart(2,'0')} elapsed. Heart rate in ${biometrics.heartRateZone} zone.`,
                bgColor: 'bg-blue-50'
            });

            // 2. PERSONALIZED HYDRATION based on weight, exercise type, and sweat rate
            if (biometrics.hydrationLevel < 90) {
                const bodyWeight = parseFloat(userProfile.weight) || 70;
                const waterNeeded = Math.round((100 - biometrics.hydrationLevel) * bodyWeight * 0.015);
                const exerciseMultiplier = {
                    running: 1.3, cycling: 1.0, swimming: 0.8, strength: 1.1, yoga: 0.6
                }[exerciseType];
                const adjustedWater = Math.round(waterNeeded * exerciseMultiplier);
                
                let urgency = '';
                if (biometrics.hydrationLevel < 70) urgency = ' URGENT:';
                else if (biometrics.hydrationLevel < 80) urgency = ' Important:';
                
                recommendations.push({
                    title: `${urgency} Hydration Alert`,
                    message: `${userProfile.name}, drink ${adjustedWater}ml water now. As a ${userProfile.activityLevel} athlete (${bodyWeight}kg), your body needs extra hydration during ${exerciseType}.`,
                    bgColor: biometrics.hydrationLevel < 70 ? 'bg-red-50' : 'bg-blue-50'
                });
            }

            // 3. AGE-SPECIFIC HEART RATE RECOMMENDATIONS
            const hrPercent = (biometrics.heartRate - 72) / (userProfile.maxHeartRate - 72) * 100;
            if (biometrics.heartRateZone === 'peak') {
                const ageGroup = userProfile.age < 25 ? 'young athlete' : userProfile.age > 50 ? 'experienced athlete' : 'athlete';
                recommendations.push({
                    title: `Peak Zone Alert for ${userProfile.age}-year-old`,
                    message: `${userProfile.name}, as a ${ageGroup}, reduce intensity to 70-85% max HR (${Math.round(userProfile.maxHeartRate * 0.7)}-${Math.round(userProfile.maxHeartRate * 0.85)} bpm) for optimal ${exerciseType} performance.`,
                    bgColor: 'bg-red-50'
                });
            } else if (biometrics.heartRateZone === 'cardio') {
                recommendations.push({
                    title: 'Perfect Cardio Zone Achievement',
                    message: `Excellent! Your ${biometrics.heartRate} bpm is ideal for your age (${userProfile.age}). This zone maximizes fat burn and cardiovascular benefits for ${exerciseType}.`,
                    bgColor: 'bg-green-50'
                });
            }

            // 4. GENDER-SPECIFIC ENERGY RECOMMENDATIONS
            if (biometrics.glycogenStores < 70) {
                const baseCarbs = userProfile.gender === 'female' ? 25 : 30;
                const intensityMultiplier = {
                    running: 1.2, cycling: 1.0, swimming: 1.1, strength: 0.8, yoga: 0.5
                }[exerciseType];
                const recommendedCarbs = Math.round(baseCarbs * intensityMultiplier);
                
                recommendations.push({
                    title: `Energy Management for ${userProfile.gender.charAt(0).toUpperCase() + userProfile.gender.slice(1)} Athletes`,
                    message: `${userProfile.name}, consume ${recommendedCarbs}g quick carbs (banana, sports drink). ${userProfile.gender === 'female' ? 'Women' : 'Men'} typically need this amount during ${exerciseType} sessions lasting ${Math.floor(exerciseDuration/60)}+ minutes.`,
                    bgColor: 'bg-yellow-50'
                });
            }

            // 5. FITNESS LEVEL SPECIFIC ADVICE
            if (exerciseDuration > 300) { // 5+ minutes
                let fitnessAdvice = '';
                switch(userProfile.activityLevel) {
                    case 'sedentary':
                        fitnessAdvice = `Great job! As someone new to exercise, listen to your body. Your current pace is building endurance safely.`;
                        break;
                    case 'light':
                        fitnessAdvice = `You're doing well! Your light activity background means gradual intensity increases will boost your fitness.`;
                        break;
                    case 'moderate':
                        fitnessAdvice = `Perfect form! Your moderate fitness level allows for sustained effort. Consider interval training next.`;
                        break;
                    case 'active':
                        fitnessAdvice = `Impressive stamina! Your active lifestyle shows - maintain this intensity for optimal gains.`;
                        break;
                    case 'athlete':
                        fitnessAdvice = `Elite performance! Your athletic conditioning allows for high-intensity sustained effort.`;
                        break;
                }
                
                recommendations.push({
                    title: `Personalized Coaching for ${userProfile.activityLevel.charAt(0).toUpperCase() + userProfile.activityLevel.slice(1)} Level`,
                    message: `${userProfile.name}, ${fitnessAdvice} Current ${exerciseType} duration: ${Math.floor(exerciseDuration/60)} minutes.`,
                    bgColor: 'bg-purple-50'
                });
            }

            // 6. BODY COMPOSITION INSIGHTS (BMI-based)
            if (userProfile.bmi && exerciseDuration > 600) { // 10+ minutes
                const bmi = parseFloat(userProfile.bmi);
                let bmiAdvice = '';
                
                if (bmi < 18.5) {
                    bmiAdvice = `With your lean build (BMI ${userProfile.bmi}), focus on maintaining energy. Consider protein intake post-workout.`;
                } else if (bmi >= 18.5 && bmi < 25) {
                    bmiAdvice = `Your healthy BMI (${userProfile.bmi}) supports optimal performance. You're in the ideal range for ${exerciseType}.`;
                } else if (bmi >= 25 && bmi < 30) {
                    bmiAdvice = `Your BMI (${userProfile.bmi}) means longer sessions like this burn significant calories. Stay hydrated!`;
                } else {
                    bmiAdvice = `Extended ${exerciseType} sessions are excellent for your goals. Monitor intensity and stay well-hydrated.`;
                }
                
                recommendations.push({
                    title: `Body Composition Insights (BMI: ${userProfile.bmi})`,
                    message: `${userProfile.name}, ${bmiAdvice}`,
                    bgColor: 'bg-indigo-50'
                });
            }

            // 7. TEMPERATURE & SAFETY for different ages/conditions
            if (biometrics.coreTemp > 37.8) {
                const ageWarning = userProfile.age > 50 ? ' Especially important at your age.' : '';
                recommendations.push({
                    title: `Temperature Safety Alert`,
                    message: `${userProfile.name}, core temp elevated to ${biometrics.coreTemp.toFixed(1)}¬∞C. Cool down gradually, find shade, and sip cool water.${ageWarning}`,
                    bgColor: 'bg-red-50'
                });
            }

            // 8. TIME-BASED MOTIVATIONAL COACHING
            if (exerciseDuration === 300) { // Exactly 5 minutes
                recommendations.push({
                    title: `5-Minute Milestone! üéâ`,
                    message: `${userProfile.name}, you've hit 5 minutes! Your ${userProfile.activityLevel} fitness level is showing. Keep this ${exerciseType} pace for maximum benefit.`,
                    bgColor: 'bg-green-50'
                });
            } else if (exerciseDuration === 600) { // 10 minutes
                recommendations.push({
                    title: `10-Minute Achievement! üèÜ`,
                    message: `Outstanding, ${userProfile.name}! 10 minutes of ${exerciseType} is burning approximately ${Math.round(exerciseDuration * 0.15 * parseFloat(userProfile.weight) / 60)} calories for your ${userProfile.weight}kg body.`,
                    bgColor: 'bg-green-50'
                });
            } else if (exerciseDuration === 900) { // 15 minutes
                recommendations.push({
                    title: `Quarter-Hour Champion! üí™`,
                    message: `${userProfile.name}, 15 minutes shows serious dedication! Your heart rate efficiency (${biometrics.heartRate} bpm) demonstrates your ${userProfile.activityLevel} conditioning.`,
                    bgColor: 'bg-green-50'
                });
            }

            // 9. EXERCISE-SPECIFIC TECHNIQUE TIPS
            if (exerciseDuration > 180 && exerciseDuration % 120 === 0) { // Every 2 minutes after 3 min
                let techniqueTip = '';
                switch(exerciseType) {
                    case 'running':
                        techniqueTip = 'Focus on midfoot landing and 180 steps/minute cadence. Breathe rhythmically with your stride.';
                        break;
                    case 'cycling':
                        techniqueTip = 'Maintain 80-100 RPM cadence. Keep your core engaged and shoulders relaxed.';
                        break;
                    case 'swimming':
                        techniqueTip = 'Focus on long, smooth strokes. Breathe bilaterally every 3 strokes for optimal oxygen.';
                        break;
                    case 'strength':
                        techniqueTip = 'Control the eccentric (lowering) phase. Rest 30-90 seconds between sets.';
                        break;
                    case 'yoga':
                        techniqueTip = 'Sync movement with breath. Hold poses for 5-8 breaths for flexibility gains.';
                        break;
                }
                
                recommendations.push({
                    title: `${exerciseType.charAt(0).toUpperCase() + exerciseType.slice(1)} Technique Optimization`,
                    message: `${userProfile.name}, ${techniqueTip} Your current form is supporting your ${userProfile.activityLevel} goals.`,
                    bgColor: 'bg-orange-50'
                });
            }

            // 10. RECOVERY PREDICTION based on user profile
            if (exerciseDuration > 900) { // 15+ minutes
                const recoveryMinutes = Math.round(exerciseDuration * 0.1 * (userProfile.age / 30) * (userProfile.activityLevel === 'athlete' ? 0.5 : 1.2));
                recommendations.push({
                    title: `Recovery Planning for ${userProfile.age}-Year-Old`,
                    message: `${userProfile.name}, based on your age and ${userProfile.activityLevel} fitness level, plan ${recoveryMinutes} minutes of active recovery after this ${exerciseType} session.`,
                    bgColor: 'bg-gray-50'
                });
            }
        }
        // Screen rendering functions
        function showWelcome() {
            currentStep = 'welcome';
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 flex items-center justify-center p-4">
                    <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 24px; padding: 2rem; max-width: 600px; width: 100%; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üß†</div>
                        <h1 style="font-size: 2.5rem; font-weight: bold; color: white; margin: 1rem 0;">
                            Welcome to BioSync
                        </h1>
                        <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem; margin: 1.5rem 0; line-height: 1.6;">
                            AI-powered nutrition optimization that adapts to your unique physiology. 
                            Let's collect your personal information for personalized recommendations.
                        </p>
                        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin: 2rem 0;">
                            <span style="font-size: 2rem;">üõ°Ô∏è</span>
                            <span style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                                Your data is secure and never shared
                            </span>
                        </div>
                        <button onclick="showProfile()" style="width: 100%; background: linear-gradient(to right, #3b82f6, #8b5cf6); color: white; font-weight: 600; padding: 1rem 2rem; border-radius: 12px; border: none; cursor: pointer; font-size: 1.1rem; transition: all 0.3s;">
                            Get Started
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showProfile() {
            currentStep = 'profile';
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gray-50 py-8">
                    <div class="max-w-2xl mx-auto px-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8">
                            <h2 class="text-3xl font-bold text-gray-800 mb-6">Personal Profile</h2>
                            <form onsubmit="handleProfileSubmit(event)" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
                                        <input type="text" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your name" id="userName">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Age *</label>
                                        <input type="number" required min="10" max="100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="25" id="userAge">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-3">Gender *</label>
                                    <div class="flex space-x-6">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="gender" value="male" required class="mr-2"> Male
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="gender" value="female" required class="mr-2"> Female
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="gender" value="other" required class="mr-2"> Other
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Weight (kg) *</label>
                                        <input type="number" required min="30" max="300" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="70" id="userWeight">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Height (cm) *</label>
                                        <input type="number" required min="100" max="250" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="175" id="userHeight">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Activity Level *</label>
                                    <select required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" id="activityLevel">
                                        <option value="">Select your activity level</option>
                                        <option value="sedentary">Sedentary (desk job, little exercise)</option>
                                        <option value="light">Light (exercise 1-3 days/week)</option>
                                        <option value="moderate">Moderate (exercise 3-5 days/week)</option>
                                        <option value="active">Active (exercise 6-7 days/week)</option>
                                        <option value="athlete">Athlete (intense daily training)</option>
                                    </select>
                                </div>
                                
                                <div id="calculatedMetrics" style="display: none;" class="bg-blue-50 rounded-lg p-4">
                                    <h3 class="font-semibold text-gray-800 mb-2">üìä Your Calculated Metrics:</h3>
                                    <div class="grid grid-cols-3 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-600">BMI:</span>
                                            <span class="font-semibold ml-2 text-blue-600" id="bmiDisplay"></span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">BMR:</span>
                                            <span class="font-semibold ml-2 text-green-600" id="bmrDisplay"></span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">Max HR:</span>
                                            <span class="font-semibold ml-2 text-red-600" id="maxHRDisplay"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all">
                                    Continue to Medical Information ‚Üí
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for real-time calculation
            setTimeout(() => {
                ['userName', 'userAge', 'userWeight', 'userHeight'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', updateProfileCalculations);
                    }
                });
                
                document.querySelectorAll('input[name="gender"]').forEach(radio => {
                    radio.addEventListener('change', updateProfileCalculations);
                });
            }, 100);
        }
        
        function updateProfileCalculations() {
            const name = document.getElementById('userName')?.value;
            const age = document.getElementById('userAge')?.value;
            const weight = document.getElementById('userWeight')?.value;
            const height = document.getElementById('userHeight')?.value;
            const gender = document.querySelector('input[name="gender"]:checked')?.value;
            
            if (age && weight && height && gender) {
                userProfile.age = age;
                userProfile.weight = weight;
                userProfile.height = height;
                userProfile.gender = gender;
                
                calculateBMI();
                
                document.getElementById('calculatedMetrics').style.display = 'block';
                document.getElementById('bmiDisplay').textContent = userProfile.bmi;
                document.getElementById('bmrDisplay').textContent = userProfile.bmr + ' cal/day';
                document.getElementById('maxHRDisplay').textContent = userProfile.maxHeartRate + ' bpm';
            }
        }
        
        function handleProfileSubmit(event) {
            event.preventDefault();
            
            userProfile.name = document.getElementById('userName').value;
            userProfile.age = document.getElementById('userAge').value;
            userProfile.weight = document.getElementById('userWeight').value;
            userProfile.height = document.getElementById('userHeight').value;
            userProfile.gender = document.querySelector('input[name="gender"]:checked').value;
            userProfile.activityLevel = document.getElementById('activityLevel').value;
            
            calculateBMI();
            showMedical();
        }
        function showMedical() {
            currentStep = 'medical';
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gray-50 py-8">
                    <div class="max-w-2xl mx-auto px-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8">
                            <h2 class="text-3xl font-bold text-gray-800 mb-6">Medical Information</h2>
                            <p class="text-gray-600 mb-8">
                                Upload your recent medical report for personalized nutrition recommendations. 
                                This step is optional but highly recommended for the most accurate guidance.
                            </p>

                            <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center mb-6 hover:border-blue-400 transition-colors">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üì§</div>
                                <h3 class="text-xl font-semibold mb-2">Upload Medical Report</h3>
                                <p class="text-gray-600 mb-4">PDF, JPG, PNG, or any image format (Max 10MB)</p>
                                <input type="file" accept=".pdf,.jpg,.jpeg,.png,.gif,.bmp" onchange="handleFileUpload(event)" class="hidden" id="medical-upload">
                                <label for="medical-upload" class="inline-block bg-blue-500 text-white px-6 py-3 rounded-lg cursor-pointer hover:bg-blue-600 transition-colors font-medium">
                                    Choose File
                                </label>
                            </div>

                            <div id="uploadStatus" style="display: none;" class="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
                                <div class="flex items-center">
                                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">‚úÖ</span>
                                    <div>
                                        <p class="font-semibold text-green-800">File Uploaded Successfully!</p>
                                        <p class="text-green-700" id="fileName"></p>
                                        <p class="text-sm text-green-600 mt-1">Analyzing your medical data...</p>
                                    </div>
                                </div>
                            </div>

                            <div id="analysisResults" style="display: none;" class="bg-blue-50 rounded-xl p-6 mb-6">
                                <h3 class="font-semibold text-lg mb-4">üî¨ Medical Report Analysis Results</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div class="bg-white p-4 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Blood Glucose:</span>
                                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
                                                Normal
                                            </span>
                                        </div>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Cholesterol:</span>
                                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
                                                Normal
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg">
                                    <h4 class="font-semibold mb-2">üéØ Personalized Recommendations:</h4>
                                    <ul class="space-y-1">
                                        <li class="flex items-start text-sm">
                                            <span class="text-blue-500 mr-2">‚Ä¢</span>
                                            <span>Monitor hydration during exercise</span>
                                        </li>
                                        <li class="flex items-start text-sm">
                                            <span class="text-blue-500 mr-2">‚Ä¢</span>
                                            <span>Maintain balanced nutrition with adequate protein</span>
                                        </li>
                                        <li class="flex items-start text-sm">
                                            <span class="text-blue-500 mr-2">‚Ä¢</span>
                                            <span>Consider electrolyte supplementation for longer workouts</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-xl p-4 mb-6">
                                <div class="flex items-start">
                                    <span style="font-size: 2rem; margin-right: 0.75rem;">üõ°Ô∏è</span>
                                    <div>
                                        <h4 class="font-semibold mb-1">Privacy & Security</h4>
                                        <p class="text-sm text-gray-600">
                                            Your medical data is processed locally in your browser and never stored on our servers. 
                                            All analysis happens in real-time and your data is completely private.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex space-x-4">
                                <button onclick="showProfile()" class="flex-1 bg-gray-200 text-gray-800 font-semibold py-3 rounded-lg hover:bg-gray-300 transition-colors">
                                    ‚Üê Back
                                </button>
                                <button onclick="showDashboard()" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all">
                                    <span id="continueText">Skip & Continue</span> üöÄ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Show upload status
                document.getElementById('uploadStatus').style.display = 'block';
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('continueText').textContent = 'Start BioSync';
                
                // Simulate analysis after 2 seconds
                setTimeout(() => {
                    document.getElementById('analysisResults').style.display = 'block';
                }, 2000);
            }
        }
        function showDashboard() {
            currentStep = 'dashboard';
            renderDashboard();
        }
        
    function renderDashboard() {
    // Store the current chart data in a more visible format
    const chartBars = historicalData.length > 0 ? 
        historicalData.slice(-30).map((data, i) => {
            const heightPercent = Math.min((data.heartRate / 200) * 100, 100);
            return `
                <div class="flex-1 flex flex-col justify-end" style="min-width: 8px;">
                    <div class="bg-gradient-to-t from-red-500 to-red-400 rounded-t transition-all duration-300 hover:from-red-600 hover:to-red-500" 
                         style="height: ${heightPercent}%; min-height: 4px; animation: grow 0.5s ease-out;"
                         title="Time: ${data.time}s | HR: ${data.heartRate} | Hydration: ${Math.round(data.hydration)}%">
                    </div>
                </div>
            `;
        }).join('') :
        `<div class="w-full flex items-center justify-center text-gray-500">
            Start exercising to see your performance data!
        </div>`;

    document.getElementById('root').innerHTML = `
        <div class="min-h-screen bg-gray-50">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b">
                <div class="max-w-7xl mx-auto px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span style="font-size: 2rem;">üß†</span>
                            <div>
                                <h1 class="text-2xl font-bold">BioSync</h1>
                                <p class="text-sm text-gray-600">Welcome back, ${userProfile.name}!</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <select id="exerciseType" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" ${isExercising ? 'disabled' : ''}>
                                <option value="running">üèÉ Running</option>
                                <option value="cycling">üö¥ Cycling</option>
                                <option value="swimming">üèä Swimming</option>
                                <option value="strength">üí™ Strength</option>
                                <option value="yoga">üßò Yoga</option>
                            </select>
                            <button onclick="toggleExercise()" class="px-6 py-2 rounded-lg font-semibold text-white transition-all ${isExercising ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'}">
                                ${isExercising ? '‚èπÔ∏è Stop' : '‚ñ∂Ô∏è Start'}
                            </button>
                            ${isExercising ? `<div class="font-mono text-lg font-bold text-blue-600">${Math.floor(exerciseDuration / 60)}:${(exerciseDuration % 60).toString().padStart(2, '0')}</div>` : ''}
                        </div>
                    </div>
                </div>
            </header>

            <!-- User Info Bar -->
            <div class="bg-blue-50 border-b px-4 py-3">
                <div class="max-w-7xl mx-auto flex items-center justify-between text-sm">
                    <div class="flex items-center space-x-6">
                        <span>üë§ <strong>Age:</strong> ${userProfile.age}</span>
                        <span>üìè <strong>BMI:</strong> ${userProfile.bmi}</span>
                        <span>üèÉ <strong>Level:</strong> ${userProfile.activityLevel}</span>
                        <span>‚ù§Ô∏è <strong>Max HR:</strong> ${userProfile.maxHeartRate} bpm</span>
                        ${isExercising ? '<span class="text-green-600 font-bold animate-pulse">üü¢ EXERCISE ACTIVE</span>' : ''}
                    </div>
                </div>
            </div>

            <!-- Main Dashboard -->
            <main class="max-w-7xl mx-auto px-4 py-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Biometric Cards -->
                    <div class="lg:col-span-2 grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Heart Rate Card -->
                        <div class="bg-red-50 rounded-xl p-4 hover:shadow-lg transition-all">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚ù§Ô∏è</div>
                            <div class="text-2xl font-bold">${biometrics.heartRate}</div>
                            <div class="text-sm text-gray-600">Heart Rate</div>
                            <div class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full mt-2 inline-block">
                                ${biometrics.heartRateZone}
                            </div>
                        </div>
                        
                        <!-- Hydration Card -->
                        <div class="bg-blue-50 rounded-xl p-4 hover:shadow-lg transition-all">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üíß</div>
                            <div class="text-2xl font-bold">${Math.round(biometrics.hydrationLevel)}%</div>
                            <div class="text-sm text-gray-600">Hydration</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: ${biometrics.hydrationLevel}%"></div>
                            </div>
                        </div>
                        
                        <!-- Energy Card -->
                        <div class="bg-yellow-50 rounded-xl p-4 hover:shadow-lg transition-all">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚ö°</div>
                            <div class="text-2xl font-bold">${Math.round(biometrics.glycogenStores)}%</div>
                            <div class="text-sm text-gray-600">Energy</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-yellow-500 h-2 rounded-full transition-all duration-500" style="width: ${biometrics.glycogenStores}%"></div>
                            </div>
                        </div>
                        
                        <!-- Temperature Card -->
                        <div class="bg-orange-50 rounded-xl p-4 hover:shadow-lg transition-all">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üå°Ô∏è</div>
                            <div class="text-2xl font-bold">${biometrics.coreTemp.toFixed(1)}¬∞C</div>
                            <div class="text-sm text-gray-600">Core Temp</div>
                            <div class="text-xs mt-2 px-2 py-1 rounded-full inline-block ${biometrics.coreTemp > 38.0 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                                ${biometrics.coreTemp > 38.0 ? '‚ö†Ô∏è High' : '‚úÖ Normal'}
                            </div>
                        </div>
                    </div>

                    <!-- AI Recommendations with Action Buttons -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            üß† AI Recommendations
                        </h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${recommendations.length > 0 ? 
                                recommendations.map((rec, index) => `
                                    <div class="${rec.bgColor} rounded-lg p-3 border-l-4 border-blue-500 ${rec.completed ? 'opacity-50' : ''}">
                                        <h4 class="font-semibold text-sm ${rec.completed ? 'line-through' : ''}">${rec.title}</h4>
                                        <p class="text-xs text-gray-700 mt-1">${rec.message}</p>
                                        ${rec.actionable && !rec.completed ? `
                                            <button onclick="completeRecommendation(${index})" class="mt-2 px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-all">
                                                ‚úì Done
                                            </button>
                                        ` : ''}
                                        ${rec.completed ? '<span class="text-xs text-green-600 mt-2 inline-block">‚úÖ Completed</span>' : ''}
                                    </div>
                                `).join('') :
                                `<div class="text-center py-8">
                                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                                    <p class="text-gray-500">${isExercising ? 'AI analyzing your performance...' : 'Start exercising to receive AI recommendations!'}</p>
                                </div>`
                            }
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">üìä Real-Time Performance</h3>
                        <div class="h-64 flex items-end space-x-1 bg-gray-50 rounded-lg p-4" id="performanceChart">
                            ${chartBars}
                        </div>
                        
                        ${isExercising && historicalData.length > 0 ? `
                            <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                                <div class="bg-red-50 p-3 rounded-lg">
                                    <p class="text-sm text-gray-600">Avg Heart Rate</p>
                                    <p class="text-lg font-bold text-red-600">
                                        ${Math.round(historicalData.reduce((sum, d) => sum + d.heartRate, 0) / historicalData.length)}
                                    </p>
                                </div>
                                <div class="bg-orange-50 p-3 rounded-lg">
                                    <p class="text-sm text-gray-600">Calories Burned</p>
                                    <p class="text-lg font-bold text-orange-600">
                                        ${Math.round(exerciseDuration * 0.15 * (parseFloat(userProfile.weight) || 70) / 60)}
                                    </p>
                                </div>
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <p class="text-sm text-gray-600">Duration</p>
                                    <p class="text-lg font-bold text-blue-600">
                                        ${Math.floor(exerciseDuration / 60)}:${(exerciseDuration % 60).toString().padStart(2, '0')}
                                    </p>
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Personal Stats -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            üë§ Your Personal Stats
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">üî• Daily Calories:</span>
                                <span class="font-bold text-orange-600">${Math.round((userProfile.bmr || 1680) * 1.5)} cal</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">üíß Water Needs:</span>
                                <span class="font-bold text-blue-600">${Math.round((parseFloat(userProfile.weight) || 70) * 35)} ml/day</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">üìà Status:</span>
                                <span class="font-bold ${isExercising ? 'text-green-600' : 'text-gray-600'}">${isExercising ? 'üèÉ Exercising' : 'üòå Resting'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    `;
}


const style = document.createElement('style');
style.textContent = `
    @keyframes grow {
        from { height: 0; }
        to { height: auto; }
    }
`;
document.head.appendChild(style);
        
        function toggleExercise() {
            if (!isExercising) {
                // Start exercise
                isExercising = true;
                exerciseDuration = 0;
                historicalData = [];
                recommendations = [];
                
                exerciseInterval = setInterval(() => {
                    exerciseDuration++;
                    updateBiometrics();
                    renderDashboard();
                }, 1000);
            } else {
                // Stop exercise
                isExercising = false;
                if (exerciseInterval) {
                    clearInterval(exerciseInterval);
                    exerciseInterval = null;
                }
                
                // Reset biometrics gradually
                biometrics.heartRate = 72;
                biometrics.heartRateZone = 'rest';
                biometrics.hydrationLevel = 100;
                biometrics.glycogenStores = 100;
                biometrics.coreTemp = 37.0;
                recommendations = [];
            }
            renderDashboard();
        }
        
        // Initialize the app
        showWelcome();

        function completeRecommendation(index) {
    const rec = recommendations[index];
    if (!rec || !rec.actionable || rec.completed) return;
    
    // Mark as completed
    rec.completed = true;
    
    // Apply the effect based on recommendation type
    switch(rec.type) {
        case 'hydration':
            // Increase hydration level
            biometrics.hydrationLevel = Math.min(100, biometrics.hydrationLevel + 15);
            showNotification('üíß Hydration restored! Great job staying hydrated.');
            break;
            
        case 'energy':
            // Increase glycogen stores
            biometrics.glycogenStores = Math.min(100, biometrics.glycogenStores + 20);
            showNotification('‚ö° Energy boosted! You\'re refueled and ready to go.');
            break;
            
        case 'cooldown':
            // Reduce core temperature
            biometrics.coreTemp = Math.max(37.0, biometrics.coreTemp - 0.5);
            biometrics.heartRate = Math.max(72, biometrics.heartRate - 10);
            showNotification('üå°Ô∏è Temperature normalized! Good recovery.');
            break;
    }
    
    // Update the display
    renderDashboard();
}

function showNotification(message) {
    // Create a temporary notification
    const notification = document.createElement('div');
    notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-pulse';
    notification.innerHTML = `
        <div class="flex items-center">
            <span class="text-xl mr-2">‚úÖ</span>
            <span>${message}</span>
        </div>
    `;
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}


        
    </script>
</body>
</html>
